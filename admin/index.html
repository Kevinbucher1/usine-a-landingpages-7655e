<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Content Manager</title>
  </head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  
  <script>
    // Plus besoin d'attendre 'DOMContentLoaded', car on est déjà à la fin de la page.
    
    // Enregistre un formateur YAML personnalisé pour forcer le formatage "literal" (`|`)
    CMS.registerCustomFormat('yaml-literal', {
      fromFile: (content) => jsyaml.load(content),
      toFile: (data) => jsyaml.dump(data, { styles: { '!!str': 'literal' } })
    });

    // Définit la configuration complète du CMS dans un objet JavaScript.
    var config = {
      backend: {
        name: "git-gateway",
        branch: "master",
      },
      media_folder: "static/img",
      collections: [
        {
          name: "landing_pages",
          label: "Landing Page",
          folder: "pages/lps",
          create: true,
          slug: "{{slug}}",
          extension: "njk",
          format: "yaml-literal", 
          fields: [
            { label: "Titre de la page", name: "title", widget: "string", required: true },
            { label: "URL personnalisée (ex: ma-super-promo)", name: "slug_url", widget: "string", required: true, hint: "Entrez juste le texte, sans les barres /" },
            { label: "Layout", name: "layout", widget: "hidden", default: "layouts/base.njk" },
            { label: "CSS & Scripts (pour le <head>)", name: "page_css", widget: "code", allow_language_selection: false, output_code_only: true },
            { label: "Contenu HTML de la page", name: "body", widget: "markdown" },
          ],
        },
        {
          name: "blog",
          label: "Article de Blog",
          folder: "posts",
          create: true,
          extension: "md",
          format: "yaml-literal",
          fields: [
            { label: "Title", name: "title", widget: "string" },
            { label: "Publish Date", name: "date", widget: "datetime" },
            { label: "Body", name: "body", widget: "markdown" },
          ],
        },
      ],
    };

    // Initialise le CMS avec la configuration définie ci-dessus.
    CMS.init({ config });
  </script>
</body>
</html>
